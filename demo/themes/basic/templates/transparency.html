<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transparency Report - {{ date_str }}</title>
    <link rel="stylesheet" href="static/css/style.css">
    <style>
        /* Transparency Specific Overrides */
        body { max-width: 800px; margin: 0 auto; padding: 2rem; }
        .audit-header { border-bottom: 2px solid #000; padding-bottom: 1rem; margin-bottom: 2rem; }
        .funnel-container { display: flex; justify-content: space-between; background: #eee; padding: 1rem; margin-bottom: 2rem; }
        .funnel-step { text-align: center; }
        .funnel-num { font-size: 1.5rem; font-weight: bold; display: block; }
        
        table.audit-table { width: 100%; border-collapse: collapse; margin-bottom: 2rem; }
        th { text-align: left; border-bottom: 2px solid #000; padding: 0.5rem; }
        td { border-bottom: 1px solid #ccc; padding: 0.5rem; }
        .bias-pos { color: green; }
        .bias-neg { color: red; }
        
        .cut-line-item { margin-bottom: 0.5rem; font-family: monospace; }
        .score-badge { display: inline-block; width: 60px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="audit-header">
        <h1>Transparency Report</h1>
        <p>Audit Log for Edition: <strong>{{ run_id }}</strong></p>
        <p>Generated: {{ timestamp }}</p>
    </div>

    <!-- The Funnel -->
    <div class="funnel-container">
        <div class="funnel-step">
            <span class="funnel-num">{{ stats_input }}</span>
            <small>Items Scanned</small>
        </div>
        <div class="funnel-step">
            <span class="funnel-num">{{ stats_pool }}</span>
            <small>Qualified Candidates</small>
        </div>
        <div class="funnel-step">
            <span class="funnel-num">{{ stats_selected }}</span>
            <small>Published</small>
        </div>
        <div class="funnel-step">
            <span class="funnel-num">{{ "%.1f"|format(yield_rate) }}%</span>
            <small>Yield Rate</small>
        </div>
    </div>

    <!-- Source Velocity (Input vs Output) -->
    <h2>Source Velocity (Top 15)</h2>
    <p><em>Are we just a mirror of our inputs? A positive Delta means the source "punches above its weight."</em></p>
    
    <table class="audit-table">
        <thead>
            <tr>
                <th>Source</th>
                <th>Input Share</th>
                <th>Output Share</th>
                <th>Delta</th>
            </tr>
        </thead>
        <tbody>
            {% for row in source_velocity %}
            <tr>
                <td>{{ row.domain }}</td>
                <td>{{ "%.1f"|format(row.input_pct) }}%</td>
                <td>{{ "%.1f"|format(row.output_pct) }}%</td>
                <td>
                    {% if row.delta > 0 %}
                    <span class="bias-pos">+{{ "%.1f"|format(row.delta) }}%</span>
                    {% elif row.delta < 0 %}
                    <span class="bias-neg">{{ "%.1f"|format(row.delta) }}%</span>
                    {% else %}
                    0.0%
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- The Cut Line -->
    <h2>The Cut Line (Near Misses)</h2>
    <p><em>High-scoring articles that were rejected due to capacity limits.</em></p>
    
    {% for section, misses in cut_line.items() %}
    <h3>{{ section }}</h3>
    {% for m in misses %}
    <div class="cut-line-item">
        <span class="score-badge">{{ "%.0f"|format(m.impact_score) }}</span>
        {{ m.title }}
    </div>
    {% endfor %}
    {% endfor %}

    <footer style="margin-top: 4rem; border-top: 1px solid #ccc; padding-top: 1rem; text-align: center;">
        <a href="index.html">&larr; Back to The Edition</a>
    </footer>

</body>
</html>
